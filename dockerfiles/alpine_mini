FROM --platform=i386 i386/alpine:edge

RUN apk add --no-cache bash coreutils mg doas && \
    apk add --no-cache --virtual .build-deps shadow && \
    addgroup -S user && \
    adduser -G user -s /bin/bash -D -S user && \
    echo "user:password" | chpasswd && \
    echo "root:password" | chpasswd && \
    echo "permit persist :user" > /etc/doas.d/doas.conf && \
    apk del .build-deps

WORKDIR /home/user/

COPY --chown=user:user image/home/ /home/user/
COPY image/bin/ /usr/local/bin/

ENV HOME="/home/user" TERM="xterm" USER="user" SHELL="/bin/bash" EDITOR="mg" LANG="en_US.UTF-8" LC_ALL="C"

USER user
CMD [ "/bin/bash" ]
